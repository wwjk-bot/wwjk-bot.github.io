<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Sessionly - confirming…</title>
  <style>
    :root{
      --bg:#0b0f14;
      --card:#111826;
      --text:#e8eef7;
      --muted:#a8b3c5;
      --accent:#3ddc97;
      --line:#22304a;
    }
    html,body{height:100%;}
    body{
      margin:0;
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial;
      background: radial-gradient(1200px 600px at 20% 0%, rgba(61,220,151,.14), transparent 60%),
                  radial-gradient(900px 500px at 80% 20%, rgba(61,220,151,.10), transparent 60%),
                  var(--bg);
      color:var(--text);
      display:flex;
      align-items:center;
      justify-content:center;
      padding:24px;
    }
    .card{
      width:min(720px, 100%);
      background: rgba(17,24,38,.88);
      border:1px solid rgba(34,48,74,.9);
      border-radius:18px;
      padding:22px;
      box-shadow: 0 20px 60px rgba(0,0,0,.45);
    }
    .title{display:flex; align-items:center; gap:10px; font-weight:800; font-size:18px; margin-bottom:12px;}
    .dot{width:10px; height:10px; border-radius:999px; background:var(--accent); box-shadow:0 0 0 6px rgba(61,220,151,.10);}
    h1{margin:0 0 8px 0; font-size:28px;}
    p{margin:0; color:var(--muted); line-height:1.45;}
    .msg{margin-top:14px; padding:12px 14px; border-radius:14px; border:1px solid rgba(34,48,74,.9); background: rgba(11,15,20,.55); }
    .ok{color:var(--accent); font-weight:700;}
    .link{color:var(--text); text-decoration:underline;}
  </style>
</head>
<body>
  <div class="card">
    <div class="title"><span class="dot"></span>Sessionly</div>
    <h1 id="h1">confirming your email…</h1>
    <p id="p">one sec, we’re finishing the setup</p>
    <div class="msg" id="msg">working…</div>
  </div>

  <!-- supabase js v2 -->
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <script>
    // IMPORTANT: set these to your project
    const SUPABASE_URL = "https://oucikdsngvdhimquclcz.supabase.co";
    const SUPABASE_ANON_KEY = "sb_publishable_gMETcAB_TRLGd8hqx48KRA_yXxE7U6v";

    const supabaseClient = supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

    const H1 = document.getElementById("h1");
    const P  = document.getElementById("p");
    const MSG= document.getElementById("msg");

    function setMsg(html){ MSG.innerHTML = html; }

    async function run(){
      try{
        const url = new URL(window.location.href);

        // supabase can send tokens in hash or query depending on flow
        const hashParams = new URLSearchParams(url.hash.replace("#",""));
        const queryParams = url.searchParams;

        const access_token  = hashParams.get("access_token")  || queryParams.get("access_token");
        const refresh_token = hashParams.get("refresh_token") || queryParams.get("refresh_token");
        const type          = hashParams.get("type")          || queryParams.get("type");
        const errorDesc     = hashParams.get("error_description") || queryParams.get("error_description");

        if(errorDesc){
          H1.textContent = "couldn’t confirm";
          P.textContent  = "something went wrong with the confirmation link";
          setMsg(`<span style="color:#ff7a7a;font-weight:700">error:</span> ${errorDesc}`);
          return;
        }

        // if tokens are present, set session
        if(access_token && refresh_token){
          const { error } = await supabaseClient.auth.setSession({ access_token, refresh_token });
          if(error){
            H1.textContent = "couldn’t confirm";
            P.textContent  = "the session could not be saved";
            setMsg(`<span style="color:#ff7a7a;font-weight:700">error:</span> ${error.message}`);
            return;
          }
        }

        H1.innerHTML = `<span class="ok">email confirmed</span>`;
        P.textContent = "taking you to your dashboard…";
        setMsg(`redirecting to <a class="link" href="./dashboard.html">dashboard</a> in 2 seconds`);

        setTimeout(() => {
          window.location.href = "./dashboard.html";
        }, 2000);

      }catch(e){
        H1.textContent = "couldn’t confirm";
        P.textContent  = "unexpected error";
        setMsg(`<span style="color:#ff7a7a;font-weight:700">error:</span> ${e?.message || e}`);
      }
    }

    run();
  </script>
</body>
</html>
